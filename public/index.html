<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–≠–∫—Å–ø–µ—Ä—Ç–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞</title>
    <link rel="stylesheet" href="style.css" class="css" />
    <link rel="icon" href="./img/favicon.ico" type="image/x-icon" />
  </head>
  <body>
    <label class="switch" title="–°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è">
      <input type="checkbox" id="themeToggle" />
      <span class="slider"></span>
    </label>
    <header>
      <h1 style="text-align: center; margin-bottom: 20px">
        –≠–∫—Å–ø–µ—Ä—Ç–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ "–í—ã–±–æ—Ä –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã"
      </h1>
    </header>
    <div id="welcomeScreen">
      <p class="helloText">–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, —É–≤–∞–∂–∞–µ–º—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å üëã</p>
      <p class="helloText">
        –í—ã —Å–æ–±–∏—Ä–∞–µ—Ç–µ—Å—å –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —ç–∫—Å–ø–µ—Ä—Ç–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π –ø–æ–¥–±–æ—Ä–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã.
      </p>
      <div class="guideText">
        –ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ä–∞–±–æ—Ç—ã, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–∑–Ω–∞–∫–æ–º—å—Ç–µ—Å—å —Å
        <a href="./guide.html" target="_blank">–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–µ–π</a>
      </div>
      <button id="startButton">–ù–∞—á–∞—Ç—å –ø–æ–¥–±–æ—Ä –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã</button>
      <br />
      <button id="switchToExpert">–ü–µ—Ä–µ–π—Ç–∏ –≤ —Ä–µ–∂–∏–º —ç–∫—Å–ø–µ—Ä—Ç–∞</button>
    </div>
    <div id="questionContainer" style="display: none">
      <h2 id="questionText">–ó–∞–≥—Ä—É–∑–∫–∞ –≤–æ–ø—Ä–æ—Å–∞...</h2>
      <div class="questionButtons">
        <div class="questionYesNo">
          <button id="yesButton">–î–∞</button>
          <button id="noButton">–ù–µ—Ç</button>
          <br />
          <button id="prevQuestionButton" style="display: none">–ù–∞–∑–∞–¥</button>
          <br />
          <button id="exitTest">–í—ã—Ö–æ–¥</button>
        </div>
      </div>
    </div>
    <div id="resultContainer">
      <div class="resultVariant">
        –í–∞–º –æ—Ç–ª–∏—á–Ω–æ –ø–æ–¥–æ–π–¥—ë—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞:
        <span id="resultText"></span>
      </div>
      <div id="resultImageContainer" style="display: none">
        <img id="resultImage" src="" alt="–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞" />
      </div>
      <p id="resultPath"></p>
      <button id="restartTestButton">–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
    </div>

    <div id="expertContainer">
      <div class="firstBlock">
        <h2>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∞–≤–∏–ª</h2>
        <label for="searchRuleId">–ü–æ–∏—Å–∫ –ø—Ä–∞–≤–∏–ª–∞ –ø–æ ID:</label>
        <br />
        <input type="number" id="searchRuleId" />
        <button id="searchRuleButton">–ü–æ–∏—Å–∫</button>
        <br />
        <label for="questionId">ID:</label>
        <input type="number" id="questionId" readonly />
        <br />
        <label for="questionTextInput">–í–æ–ø—Ä–æ—Å:</label>
        <input type="text" id="questionTextInput" />
        <br />
        <label for="yesLink">–°—Å—ã–ª–∫–∞ "–î–∞":</label>
        <input type="number" id="yesLink" />
        <br />
        <label for="noLink">–°—Å—ã–ª–∫–∞ "–ù–µ—Ç":</label>
        <input type="number" id="noLink" />
        <br />
        <label for="keyField">–ö–ª—é—á–µ–≤–æ–µ –ø–æ–ª–µ:</label>
        <input type="number" id="keyField" min="0" max="1" />
        <br />
        <label for="negativeField">–ù–µ–≥–∞—Ç–∏–≤–Ω—ã–π –≤–æ–ø—Ä–æ—Å:</label>
        <input type="text" id="negativeField" />
        <br />
        <button id="saveChanges">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
        <br />
        <button id="prevRule">–ù–∞–∑–∞–¥</button>
        <button id="nextRule">–í–ø–µ—Ä–µ–¥</button>

        <br />
        <button id="firstRule">–í –Ω–∞—á–∞–ª–æ</button>
        <button id="lastRule">–í –∫–æ–Ω–µ—Ü</button>
        <br />
        <button id="addRule">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ –ø—Ä–∞–≤–∏–ª–æ</button>

        <button id="switchToUser">–ü–µ—Ä–µ–π—Ç–∏ –≤ —Ä–µ–∂–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</button>
      </div>
      <div id="knowledgeBaseTableContainer">
        <table id="knowledgeBaseTable" style="display: none">
          <thead>
            <tr>
              <th>ID</th>
              <th>–í–æ–ø—Ä–æ—Å</th>
              <th>–°—Å—ã–ª–∫–∞ "–î–∞"</th>
              <th>–°—Å—ã–ª–∫–∞ "–ù–µ—Ç"</th>
              <th>–ö–ª—é—á–µ–≤–æ–µ –ø–æ–ª–µ</th>
              <th>–ù–µ–≥–∞—Ç–∏–≤–Ω—ã–π –≤–æ–ø—Ä–æ—Å</th>
            </tr>
          </thead>
          <tbody id="knowledgeBaseTableBody"></tbody>
        </table>
      </div>
      <div id="uploadImageContainer">
        <h2>–ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã</h2>
        <label for="keyboardId">–í–≤–µ–¥–∏—Ç–µ ID –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã:</label>
        <input type="number" id="keyboardId" required />
        <br />
        <label for="imageUpload">–í—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ:</label>
        <input type="file" id="imageUpload" accept="image/*" required />
        <br />
        <button id="uploadImageButton">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</button>
      </div>

      <div id="keyboardList">
        <h2>–°–ø–∏—Å–æ–∫ –∫–ª–∞–≤–∏–∞—Ç—É—Ä —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏</h2>
        <ul id="keyboardListContainer"></ul>
      </div>
    </div>

    <script>
      document
        .getElementById("startButton")
        .addEventListener("click", function () {
          document.getElementById("welcomeScreen").style.display = "none";
          document.getElementById("questionContainer").style.display = "block";
        });

      let currentQuestionId = 1; // –ù–∞—á–∞–ª—å–Ω—ã–π –≤–æ–ø—Ä–æ—Å
      let questionsData = [];
      let questionHistory = []; // –ú–∞—Å—Å–∏–≤ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ –≤–æ–ø—Ä–æ—Å–æ–≤
      let currentRuleIndex = 0; // –ò–Ω–¥–µ–∫—Å —Ç–µ–∫—É—â–µ–≥–æ –ø—Ä–∞–≤–∏–ª–∞

      async function fetchQuestionsData() {
        const response = await fetch(
          `http://176.108.253.74:3000/data?timestamp=${new Date().getTime()}`
        );
        if (response.ok) {
          questionsData = await response.json();
          loadQuestion(); // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–≤—ã–π –≤–æ–ø—Ä–æ—Å
        } else {
          alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö");
        }
      }

      document
        .getElementById("exitTest")
        .addEventListener("click", function () {
          const confirmation = confirm("–í—ã —Ç–æ—á–Ω–æ —Ö–æ—Ç–∏—Ç–µ –∑–∞–≤–µ—Ä—à–∏—Ç—å –æ–ø—Ä–æ—Å?");

          if (confirmation) {
            document.getElementById("questionContainer").style.display = "none";

            document.getElementById("welcomeScreen").style.display = "block";
          }
        });

      async function loadQuestion() {
        const response = await fetch("http://176.108.253.74:3000/ask", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ currentQuestionId }),
        });

        if (response.ok) {
          const data = await response.json(); // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Ç–µ–∫—É—â–µ–≥–æ –≤–æ–ø—Ä–æ—Å–∞
          console.log("–ü–æ–ª—É—á–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:", data);

          if (data.result) {
            // –ï—Å–ª–∏ –µ—Å—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –µ–≥–æ
            document.getElementById("questionContainer").style.display = "none";
            document.getElementById("resultContainer").style.display = "block";
            document.getElementById("resultText").innerText =
              data.result + "‚å®Ô∏è";

            // –í—ã–≤–æ–¥–∏–º –ø—É—Ç—å –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É
            const path = questionHistory
              .map((q) => `${q.question} - ${q.answer}`)
              .join("\n");
            document.getElementById(
              "resultPath"
            ).innerText = `–í–∞—à–∏ –æ—Ç–≤–µ—Ç—ã: \n${path}`;

            // –ü–æ–ª—É—á–∞–µ–º ID –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑ —Ç–µ–∫—É—â–µ–≥–æ –≤–æ–ø—Ä–æ—Å–∞
            const imageId = currentQuestionId; // –ò—Å–ø–æ–ª—å–∑—É–µ–º currentQuestionId –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è ID –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
            console.log("ID –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:", imageId);

            if (imageId !== undefined && imageId !== null) {
              const imageUrl = `./img/keyboards/${imageId}.webp`;

              // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
              const imageExists = await checkImageExists(imageUrl);
              if (imageExists) {
                document.getElementById("resultImage").src = imageUrl;
                document.getElementById("resultImageContainer").style.display =
                  "block"; // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º
              } else {
                document.getElementById("resultImageContainer").style.display =
                  "none"; // –°–∫—Ä—ã–≤–∞–µ–º, –µ—Å–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–µ—Ç
              }
            } else {
              console.error("ID –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω.");
              document.getElementById("resultImageContainer").style.display =
                "none"; // –°–∫—Ä—ã–≤–∞–µ–º, –µ—Å–ª–∏ ID –Ω–µ—Ç
            }
          } else {
            // –ï—Å–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –Ω–µ—Ç, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤–æ–ø—Ä–æ—Å
            document.getElementById("questionText").innerText = data.question;

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–π –≤–æ–ø—Ä–æ—Å –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –Ω–æ–≤–æ–≥–æ –≤ –∏—Å—Ç–æ—Ä–∏—é
            const previousQuestionId = currentQuestionId;

            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –∫–Ω–æ–ø–æ–∫ "–î–∞" –∏ "–ù–µ—Ç"
            document.getElementById("yesButton").onclick = () => {
              questionHistory.push({
                id: previousQuestionId,
                question: data.question,
                answer: "–î–∞",
              });
              currentQuestionId = data.yes;
              console.log("–ò—Å—Ç–æ—Ä–∏—è –ø–æ—Å–ª–µ '–î–∞':", questionHistory);
              loadQuestion();
              document.getElementById("prevQuestionButton").style.display =
                "block"; // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ù–∞–∑–∞–¥"
            };

            document.getElementById("restartTestButton").onclick = () => {
              // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
              currentQuestionId = 1; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º ID —Ç–µ–∫—É—â–µ–≥–æ –≤–æ–ø—Ä–æ—Å–∞
              questionHistory = []; // –û—á–∏—â–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é –≤–æ–ø—Ä–æ—Å–æ–≤

              // –°–∫—Ä—ã–≤–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è
              document.getElementById("resultContainer").style.display = "none";
              document.getElementById("welcomeScreen").style.display = "block"; // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è
              document.getElementById("questionContainer").style.display =
                "none"; // –°–∫—Ä—ã–≤–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤–æ–ø—Ä–æ—Å–æ–≤

              // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–≤—ã–π –≤–æ–ø—Ä–æ—Å
              loadQuestion();
            };

            document.getElementById("prevQuestionButton").onclick = () => {
              if (questionHistory.length > 0) {
                const lastQuestion = questionHistory.pop(); // –£–¥–∞–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π –≤–æ–ø—Ä–æ—Å –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏
                currentQuestionId = lastQuestion.id; // –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—É –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –≤–æ–ø—Ä–æ—Å–∞
                console.log("–í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ –≤–æ–ø—Ä–æ—Å—É —Å ID:", currentQuestionId);
                loadQuestion(); // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –≤–æ–ø—Ä–æ—Å

                // –ï—Å–ª–∏ –±–æ–ª—å—à–µ –Ω–µ—Ç –≤–æ–ø—Ä–æ—Å–æ–≤ –≤ –∏—Å—Ç–æ—Ä–∏–∏, —Å–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ù–∞–∑–∞–¥"
                if (questionHistory.length === 0) {
                  document.getElementById("prevQuestionButton").style.display =
                    "none";
                }
              }
            };

            document.getElementById("noButton").onclick = () => {
              questionHistory.push({
                id: previousQuestionId,
                question: data.question,
                answer: "–ù–µ—Ç",
              });
              currentQuestionId = data.no;
              console.log("–ò—Å—Ç–æ—Ä–∏—è –ø–æ—Å–ª–µ '–ù–µ—Ç':", questionHistory);
              loadQuestion();
              document.getElementById("prevQuestionButton").style.display =
                "block"; // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ù–∞–∑–∞–¥"
            };
          }
        } else {
          console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –≤–æ–ø—Ä–æ—Å–∞:", response.statusText);
          document.getElementById("questionText").innerText =
            "–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –≤–æ–ø—Ä–æ—Å–∞";
        }
      }

      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
      async function checkImageExists(url) {
        return new Promise((resolve) => {
          const img = new Image();
          img.src = url;
          img.onload = () => resolve(true);
          img.onerror = () => resolve(false);
        });
      }

      document.getElementById("uploadImageButton").onclick = async () => {
        const keyboardId = document.getElementById("keyboardId").value; // –ü–æ–ª—É—á–∞–µ–º ID –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
        const imageFile = document.getElementById("imageUpload").files[0]; // –ü–æ–ª—É—á–∞–µ–º —Ñ–∞–π–ª –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

        if (!keyboardId || !imageFile) {
          alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ ID –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –∏ –≤—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ.");
          return;
        }

        const formData = new FormData();
        formData.append("image", imageFile); // –î–æ–±–∞–≤–ª—è–µ–º —Ñ–∞–π–ª –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        formData.append("id", keyboardId); // –î–æ–±–∞–≤–ª—è–µ–º ID –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã

        try {
          const response = await fetch(
            "http://176.108.253.74:3000/upload-image",
            {
              method: "POST",
              body: formData,
            }
          );

          if (response.ok) {
            const result = await response.json();
            alert(result.message); // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–µ
            fetchKeyboardList();
          } else {
            const error = await response.json();
            alert("–û—à–∏–±–∫–∞: " + error.error); // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
          }
        } catch (error) {
          console.error("–û—à–∏–±–∫–∞:", error);
          alert("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ: " + error.message);
        }
      };

      function loadRule() {
        const rule = questionsData.questions[currentRuleIndex];
        if (rule) {
          document.getElementById("questionId").value = rule.id;
          document.getElementById("questionTextInput").value = rule.question;
          document.getElementById("yesLink").value = rule.yes;
          document.getElementById("noLink").value = rule.no;
          document.getElementById("keyField").value = rule.key_field;
          document.getElementById("negativeField").value = rule.negative;
        } else {
          alert("–ü—Ä–∞–≤–∏–ª–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.");
        }
      }

      document.getElementById("firstRule").onclick = () => {
        currentRuleIndex = 0; // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–Ω–¥–µ–∫—Å –Ω–∞ 0 (–ø–µ—Ä–≤–æ–µ –ø—Ä–∞–≤–∏–ª–æ)
        loadRule(); // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–≤–æ–µ –ø—Ä–∞–≤–∏–ª–æ
      };

      document.getElementById("lastRule").onclick = () => {
        currentRuleIndex = questionsData.questions.length - 1; // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–Ω–¥–µ–∫—Å –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —ç–ª–µ–º–µ–Ω—Ç
        loadRule(); // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–µ–µ –ø—Ä–∞–≤–∏–ª–æ
      };

      document.getElementById("switchToExpert").onclick = async () => {
        // –≠–ª–µ–º–µ–Ω—Ç –¥–ª—è –∑–∞—Ç–µ–º–Ω–µ–Ω–∏—è —Ñ–æ–Ω–∞
        const overlay = document.createElement("div");
        overlay.style.position = "fixed";
        overlay.style.top = "0";
        overlay.style.left = "0";
        overlay.style.width = "100%";
        overlay.style.height = "100%";
        overlay.style.backgroundColor = "rgba(0, 0, 0, 0.5)";
        overlay.style.zIndex = "999";

        const passwordInput = document.createElement("input");
        passwordInput.style.padding = "6px";
        passwordInput.style.border = "1px solid black";
        passwordInput.style.marginRight = "8px";
        passwordInput.type = "password";
        passwordInput.placeholder = "–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å:";

        // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        const modal = document.createElement("div");
        modal.style.position = "fixed";
        modal.style.top = "50%";
        modal.style.left = "50%";
        modal.style.transform = "translate(-50%, -50%)";
        modal.style.backgroundColor = "white";
        modal.style.padding = "30px";
        modal.style.border = "1px solid red";
        modal.style.boxShadow = "0 0 10px rgba(0, 0, 0, 0.5)";
        modal.style.zIndex = "1000"; // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º z-index –≤—ã—à–µ overlay
        modal.style.display = "flex";
        modal.style.justifyContent = "center";
        modal.style.alignItems = "center";

        modal.appendChild(passwordInput);

        const confirmButton = document.createElement("button");
        confirmButton.innerText = "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å";
        modal.appendChild(confirmButton);

        const cancelButton = document.createElement("button");
        cancelButton.innerText = "–û—Ç–º–µ–Ω–∞";
        cancelButton.style.marginLeft = "10px";
        modal.appendChild(cancelButton);

        // –î–æ–±–∞–≤–ª—è–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏ –∑–∞—Ç–µ–º–Ω–µ–Ω–∏–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É
        document.body.appendChild(overlay);
        document.body.appendChild(modal);

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ –∫–Ω–æ–ø–∫—É –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
        confirmButton.onclick = async () => {
          const password = passwordInput.value;
          if (password === "admin") {
            document.getElementById("welcomeScreen").style.display = "none";
            document.getElementById("questionContainer").style.display = "none";
            document.getElementById("expertContainer").style.display = "block";
            document
              .getElementById("expertContainer")
              .classList.add("expertContainer-show");

            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –≤–æ–ø—Ä–æ—Å–æ–≤
            await fetchQuestionsData(); // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
            loadRule(); // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ–∫—É—â–µ–µ –ø—Ä–∞–≤–∏–ª–æ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ
          } else {
            alert("–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–∞—Ä–æ–ª—å");
          }

          // –£–¥–∞–ª—è–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏ –∑–∞—Ç–µ–º–Ω–µ–Ω–∏–µ –ø–æ—Å–ª–µ –≤–≤–æ–¥–∞
          document.body.removeChild(modal);
          document.body.removeChild(overlay);
        };

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ –∫–Ω–æ–ø–∫—É "–û—Ç–º–µ–Ω–∞"
        cancelButton.onclick = () => {
          document.body.removeChild(modal);
          document.body.removeChild(overlay);
        };

        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∑–∞—Ç–µ–º–Ω–µ–Ω–∏–µ
        overlay.onclick = () => {
          document.body.removeChild(modal);
          document.body.removeChild(overlay);
        };
      };

      document.getElementById("switchToUser").onclick = async () => {
        document
          .getElementById("expertContainer")
          .classList.remove("expertContainer-show");
        document.getElementById("expertContainer").style.display = "none";
        document.getElementById("welcomeScreen").style.display = "block"; // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è
        document.getElementById("questionContainer").style.display = "none"; // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤–æ–ø—Ä–æ—Å–æ–≤

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤–æ–ø—Ä–æ—Å–æ–≤
        await fetchQuestionsData(); // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
        loadQuestion(); // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–≤—ã–π –≤–æ–ø—Ä–æ—Å
      };

      document.getElementById("saveChanges").onclick = async () => {
        const updatedRule = {
          id: parseInt(document.getElementById("questionId").value),
          question: document.getElementById("questionTextInput").value,
          yes: parseInt(document.getElementById("yesLink").value),
          no: parseInt(document.getElementById("noLink").value),
          key_field: parseInt(document.getElementById("keyField").value),
          negative: document.getElementById("negativeField").value,
        };

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Å—Å—ã–ª–æ–∫
        const yesExists = questionsData.questions.some(
          (q) => q.id === updatedRule.yes
        );
        const noExists = questionsData.questions.some(
          (q) => q.id === updatedRule.no
        );

        if (!yesExists && updatedRule.yes !== 0) {
          alert("–û—à–∏–±–∫–∞: –°—Å—ã–ª–∫–∞ '–î–∞' –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.");
          return;
        }

        if (!noExists && updatedRule.no !== 0) {
          alert("–û—à–∏–±–∫–∞: –°—Å—ã–ª–∫–∞ '–ù–µ—Ç' –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.");
          return;
        }

        questionsData.questions[currentRuleIndex] = updatedRule;

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
        try {
          const response = await fetch("http://176.108.253.74:3000/save", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(questionsData),
          });

          if (!response.ok) {
            throw new Error("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ");
          }

          alert("–ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã");

          // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–±–ª–∏—Ü—É –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
          displayKnowledgeBase(); // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ —Ç–∞–±–ª–∏—Ü–µ
        } catch (error) {
          console.error("–û—à–∏–±–∫–∞:", error);
          alert("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è: " + error.message);
        }
      };

      document.getElementById("prevRule").onclick = () => {
        if (currentRuleIndex > 0) {
          currentRuleIndex--;
          loadRule();
        }
      };

      document.getElementById("nextRule").onclick = () => {
        if (currentRuleIndex < questionsData.questions.length - 1) {
          currentRuleIndex++;
          loadRule();
        }
      };

      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–∞—è —Ç–µ–º–∞ –≤ localStorage
      const savedTheme = localStorage.getItem("theme");
      if (savedTheme === "dark") {
        document.body.classList.add("dark-theme");
        document.getElementById("themeToggle").checked = true; // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è
      }

      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã
      function toggleTheme() {
        document.body.classList.toggle("dark-theme");
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â—É—é —Ç–µ–º—É –≤ localStorage
        if (document.body.classList.contains("dark-theme")) {
          localStorage.setItem("theme", "dark");
        } else {
          localStorage.setItem("theme", "light");
        }
      }

      // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è –¥–ª—è –∫–Ω–æ–ø–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã
      document.getElementById("themeToggle").onclick = toggleTheme;

      document.getElementById("addRule").onclick = async () => {
        const newRule = {
          question: document.getElementById("questionTextInput").value,
          yes: 0, // –°—Å—ã–ª–∫–∞ "–î–∞" –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
          no: 0, // –°—Å—ã–ª–∫–∞ "–ù–µ—Ç" –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
          key_field: parseInt(document.getElementById("keyField").value) || 0,
          negative: document.getElementById("negativeField").value || "",
        };

        // –ù–∞—Ö–æ–¥–∏–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π ID, —á—Ç–æ–±—ã –ø—Ä–∏—Å–≤–æ–∏—Ç—å –Ω–æ–≤—ã–π
        const maxId = questionsData.questions.reduce(
          (max, q) => (q.id > max ? q.id : max),
          0
        );
        newRule.id = maxId + 1; // –ü—Ä–∏—Å–≤–∞–∏–≤–∞–µ–º –Ω–æ–≤—ã–π ID

        // –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–æ–≤–æ–≥–æ –ø—Ä–∞–≤–∏–ª–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
        try {
          const response = await fetch("http://176.108.253.74:3000/add-rule", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(newRule),
          });

          if (response.ok) {
            alert("–ù–æ–≤–æ–µ –ø—Ä–∞–≤–∏–ª–æ —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ");
            fetchQuestionsData(); // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
            location.reload();
          } else {
            throw new Error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ –ø—Ä–∞–≤–∏–ª–∞");
          }
        } catch (error) {
          console.error("–û—à–∏–±–∫–∞:", error);
          alert("–ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ –ø—Ä–∞–≤–∏–ª–æ: " + error.message);
        }
      };

      async function fetchKeyboardList() {
        try {
          const response = await fetch("http://176.108.253.74:3000/keyboards");
          if (response.ok) {
            const keyboards = await response.json();
            displayKeyboardList(keyboards);
          } else {
            throw new Error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–ø–∏—Å–∫–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä");
          }
        } catch (error) {
          console.error("–û—à–∏–±–∫–∞:", error);
          alert("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∫–ª–∞–≤–∏–∞—Ç—É—Ä: " + error.message);
        }
      }

      function displayKeyboardList(keyboards) {
        const keyboardListContainer = document.getElementById(
          "keyboardListContainer"
        );
        keyboardListContainer.innerHTML = ""; // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä

        keyboards.forEach((keyboard) => {
          const listItem = document.createElement("li");

          // –°–æ–∑–¥–∞–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
          const imageLink = document.createElement("a");
          imageLink.href = keyboard.imagePath; // –ü—É—Ç—å –∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é
          imageLink.target = "_blank"; // –û—Ç–∫—Ä—ã–≤–∞—Ç—å –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ
          imageLink.textContent = `ID: ${keyboard.id}, –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ`;

          // –ö–Ω–æ–ø–∫–∞ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è
          const deleteButton = document.createElement("button");
          deleteButton.textContent = "‚ùå";
          deleteButton.onclick = async () => {
            const confirmed = confirm(
              "–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ?"
            );
            if (confirmed) {
              await deleteImage(keyboard.id);
              fetchKeyboardList(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è
            }
          };

          // –î–æ–±–∞–≤–ª—è–µ–º —Å—Å—ã–ª–∫—É –∏ –∫–Ω–æ–ø–∫—É –≤ —ç–ª–µ–º–µ–Ω—Ç —Å–ø–∏—Å–∫–∞
          listItem.appendChild(imageLink);
          listItem.appendChild(deleteButton);
          keyboardListContainer.appendChild(listItem);
        });
      }

      async function deleteImage(keyboardId) {
        console.log(keyboardId);

        try {
          const response = await fetch(
            `http://176.108.253.74:3000/delete-image/${keyboardId}`,
            {
              method: "DELETE",
            }
          );

          if (!response.ok) {
            throw new Error("–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è");
          }

          alert("–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–æ!");
        } catch (error) {
          console.error("–û—à–∏–±–∫–∞:", error);
          alert("–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ: " + error.message);
        }
      }

      fetchKeyboardList();

      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–≤–æ–¥–∞ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π –≤ —Ç–∞–±–ª–∏—Ü—É
      function displayKnowledgeBase() {
        const knowledgeBaseTableBody = document.getElementById(
          "knowledgeBaseTableBody"
        );
        knowledgeBaseTableBody.innerHTML = ""; // –û—á–∏—â–∞–µ–º —Ç–∞–±–ª–∏—Ü—É

        questionsData.questions.forEach((rule) => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${rule.id}</td>
            <td>${rule.question}</td>
            <td>${rule.yes}</td>
            <td>${rule.no}</td>
            <td>${rule.key_field}</td>
            <td>${rule.negative}</td>
        `;
          knowledgeBaseTableBody.appendChild(row);
        });

        document.getElementById("knowledgeBaseTable").style.display = "block"; // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–∞–±–ª–∏—Ü—É
      }

      // –í—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –≤—ã–≤–æ–¥–∞ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö
      fetchQuestionsData().then(() => {
        displayKnowledgeBase();
      });

      document.getElementById("searchRuleButton").onclick = () => {
        const searchRuleId = parseInt(
          document.getElementById("searchRuleId").value
        );
        const rule = questionsData.questions.find((q) => q.id === searchRuleId);
        if (rule) {
          currentRuleIndex = questionsData.questions.indexOf(rule);
          loadRule();
        } else {
          alert("–ü—Ä–∞–≤–∏–ª–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.");
        }
      };

      // –ù–∞—á–∏–Ω–∞–µ–º —Å –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
      fetchQuestionsData();
    </script>
  </body>
</html>
